#
# $Id$
# $Source$
# Copyright 2010 Brad Lanam, Walnut Creek, California USA
#
#
option-file ../dioptions.dat

loadunit d-main

output  config.d

standard

csizes

chdr    libintl.h
chdr    linux/dqblk_xfs.h
chdr    linux/quota.h
chdr    mntent.h
chdr    rpc/rpc.h
chdr    rpcsvc/rquota.h
chdr    rpc/types.h
chdr    ufs/quota.h
chdr    ufs/ufs/quota.h
chdr    locale.h
chdr    unistd.h
#chdr    windows.h

csys    fs/ufs_quota.h
csys    quota.h
csys    types.h
csys    statvfs.h

# di
chdr    version.h

clib    bindtextdomain -lintl, -lintl -liconv
clib    endmntent
clib    getegid
clib    geteuid
clib    getmntent -lgen
clib    gettext -lintl, -lintl -liconv
clib    getvfsstat
clib    quotactl
clib    setlocale
clib    setmntent
clib    statvfs
clib    textdomain -lintl, -lintl -liconv

# windows
#clib    GetDiskFreeSpace
#clib    GetDiskFreeSpaceEx
#clib    GetDriveType
#clib    GetLogicalDriveStrings
#clib    GetVolumeInformation

# NFS quotas
clib    auth_destroy
clib    clnt_call
clib    clnt_create
clib    clnt_destroy
clib    xdr_quota_get
clib    xdr_quota_rslt

cdefine hex LC_ALL
cdefine int TRUE
cdefine int FALSE

# for diquota.d
cdefine hex SUBCMDSHIFT
cdefine hex SUBCMDMASK
cmacro  QCMD sys/quota.h int int
cdefine hex Q_GETQUOTA
cdefine hex Q_XGETQUOTA
cdefine hex USRQUOTA
cdefine hex GRPQUOTA
cdefine int RQ_PATHLEN
cdefine int __FreeBSD__
cdefine int _AIX
# Linux: _PATH_MOUNTED mntent.h; MNTTYPE_IGNORE mntent.h
cdefine string _PATH_MOUNTED
cdefine string _PATH_MNTTAB
cdefine string MOUNTED
cdefine string MNTTAB
cdefine string MNTTYPE_IGNORE
# linux
cdefine hex BLOCK_SIZE
# aix
cdefine hex DQBSIZE
# tru64, et. al.
cdefine hex DEV_BSIZE

# di
cdefine string DI_VERSION

# uid/gid; geteuid, getegid
ctype int gid_t
ctype int __gid_t
ctype int uid_t
ctype int __uid_t

# linux
ctype int __fsblkcnt_t
ctype int __fsfilcnt_t
# linux, 64-bit interface
ctype int __fsblkcnt64_t
ctype int __fsfilcnt64_t
# statvfs structure
cstruct statvfs

# linux
cstruct mntent

# from linux/dqblk_xfs.h
ctype int __s8
ctype int __s16
ctype int __s32
ctype int __u16
ctype int __u32
ctype int __u64
cstruct fs_disk_quota

# from rpcsvc/rquota.h
ctype int bool_t
ctype int enum_t
ctype int u_int
ctype int u_long
ctype int u_int64_t
ctype int u_int32_t
ctype int int32_t
cstruct rquota
ctypedef rquota
cenum   gqr_status
ctypedef gqr_status
cstruct getquota_rslt
cstruct dqblk

# NFS quotas
cenum xdr_op
cenum clnt_stat
cenum auth_stat
ctypedef __caddr_t
ctypedef caddr_t
ctypedef xdrproc_t
ctype int  __time_t
ctype int  __suseconds_t
cstruct timeval
cstruct rpc_err
cstruct getquota_args
cstruct opaque_auth
cunion des_block
cstruct XDR
ctypedef XDR
cstruct AUTH
ctypedef AUTH
cstruct CLIENT
ctypedef CLIENT

cdcl    bindtextdomain
cdcl    endmntent
cdcl    getegid
cdcl    geteuid
cdcl    getmntent
cdcl    args noconst quotactl
cdcl    gettext
cdcl    args noconst getvfsstat
cdcl    setlocale
cdcl    args noconst setmntent
cdcl    statvfs
cdcl    textdomain

# windows
#cdcl    GetDiskFreeSpace
#cdcl    GetDiskFreeSpaceEx
#cdcl    GetDriveType
#cdcl    GetLogicalDriveStrings
#cdcl    GetVolumeInformation

# NFS quotas
cdcl    auth_destroy
cdcl    clnt_call
cdcl    clnt_create
cdcl    clnt_destroy
cdcl    xdr_quota_get
cdcl    xdr_quota_rslt

cmember  statvfs f_basetype
cmember  dqblk dqb_curspace
cmember  dqblk dqb_curblocks
cmember  dqblk dqb_fhardlimit
cmember  dqblk dqb_fsoftlimit
cmember  dqblk dqb_curfiles
cmember  getquota_rslt gqr_status
cmember  getquota_rslt gqr_rquota

command msgfmt
command gmsgfmt

# see dioptions.dat to change these
option  DI_DEFAULT_FORMAT smbuvpT
option  DI_DEFAULT_DISP_SIZE H

ifnotoption NLS
  set _lib_bindtextdomain 0
  set _lib_gettext 0
  set _lib_setlocale 0
  set _lib_textdomain 0
  set _hdr_libintl 0
  set _hdr_locale 0
  set _command_msgfmt 0
  set _command_gmsgfmt 0
endif

if hasnls _clib_bindtextdomain && _clib_gettext && _clib_setlocale && \
    _clib_textdomain && _hdr_libintl && _hdr_locale && \
    ( _command_msgfmt || _command_gmsgfmt )
  setint _enable_nls 1
else
  set _clib_bindtextdomain 0
  set _clib_gettext 0
  set _clib_setlocale 0
  set _clib_textdomain 0
  set _hdr_libintl 0
  set _hdr_locale 0
  set _command_msgfmt 0
  set _command_gmsgfmt 0
  setint _enable_nls 0
endif

if stdquotas _hdr_linux_quota || _hdr_ufs_quota || _hdr_ufs_ufs_quota || \
    _sys_fs_ufs_quota || _sys_quota || _clib_quotactl
  setint _has_std_quotas 1
else
  setint _has_std_quotas 0
endif

include

static if (_ctype_uid_t > 0) {
  alias C_TYP_uid_t   Uid_t;
} else {
  alias int     Uid_t;
}

static if (_ctype_gid_t > 0) {
  alias C_TYP_gid_t   Gid_t;
} else {
  alias int     Gid_t;
}

enum string DI_PROG = "di";
enum string DI_PREFIX = "/home/bll/DI/di/C/test_di";
import core.stdc.stdio;  // for FILE

endinclude
